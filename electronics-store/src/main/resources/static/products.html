<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–æ–≤–∞—Ä—ã ‚Äî Electronics Store</title>
    <link rel="stylesheet" href="/css/app.css">
</head>
<body>
<div class="layout">
    <aside class="sidebar">
        <div class="logo">
            <span class="logo-dot"></span>
            <span>Electronics Store</span>
        </div>
        <nav class="sidebar-nav">
            <a class="nav-link" href="/dashboard.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a class="nav-link" href="/categories.html">üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
            <a class="nav-link active" href="/products.html">üíª –¢–æ–≤–∞—Ä—ã</a>
            <a class="nav-link" href="/orders.html">üßæ –ó–∞–∫–∞–∑—ã</a>
        </nav>
    </aside>
    <main class="main">
        <header class="main-header">
            <div>
                <div class="main-title" id="productsTitle">–¢–æ–≤–∞—Ä—ã</div>
                <div class="main-subtitle" id="productsSubtitle">–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ü–∏–∏</div>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
                <button class="btn btn-ghost" id="langToggle">RU</button>
            </div>
        </header>
        <div class="content">
            <section class="card">
                <div class="section-title-row">
                    <div class="card-title" id="productsFilterTitle">–§–∏–ª—å—Ç—Ä</div>
                </div>
                <div class="form-grid">
                    <div>
                        <label for="filterQuery" id="filterQueryLabel">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É</label>
                        <input id="filterQuery" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, iPhone –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª SKU-IPH-15">
                    </div>
                    <div>
                        <label for="filterType" id="filterTypeLabel">–í–∏–¥ —Ç–æ–≤–∞—Ä–∞</label>
                        <select id="filterType">
                            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                            <option value="SMARTPHONES_AND_GADGETS">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –≥–∞–¥–∂–µ—Ç—ã</option>
                            <option value="COMPUTERS_AND_LAPTOPS">–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –Ω–æ—É—Ç–±—É–∫–∏</option>
                            <option value="PC_COMPONENTS">–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ –¥–ª—è –ü–ö</option>
                            <option value="PC_PERIPHERALS_AND_ACCESSORIES">–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –¥–ª—è –ü–ö</option>
                            <option value="TV_AND_VIDEO">–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã –∏ –≤–∏–¥–µ–æ</option>
                            <option value="AUDIO">–ê—É–¥–∏–æ</option>
                            <option value="PHOTO_AND_VIDEO">–§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ—Ç–µ—Ö–Ω–∏–∫–∞</option>
                            <option value="GAMES_AND_CONSOLES">–ò–≥—Ä—ã –∏ –∫–æ–Ω—Å–æ–ª–∏</option>
                            <option value="SMART_HOME">–£–º–Ω—ã–π –¥–æ–º</option>
                            <option value="NETWORK_EQUIPMENT">–°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
                            <option value="OFFICE_EQUIPMENT">–û—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞ –∏ –æ—Ñ–∏—Å</option>
                            <option value="STORAGE_AND_MEMORY">–ù–æ—Å–∏—Ç–µ–ª–∏ –∏ –ø–∞–º—è—Ç—å</option>
                            <option value="CABLES_AND_ADAPTERS">–ö–∞–±–µ–ª–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫–∏</option>
                            <option value="CHARGERS_AND_POWER">–ó–∞—Ä—è–¥–∫–∏ –∏ –ø–∏—Ç–∞–Ω–∏–µ</option>
                            <option value="SMALL_APPLIANCES">–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ (–º–∞–ª–∞—è)</option>
                            <option value="CLIMATE_APPLIANCES">–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</option>
                            <option value="CAR_ELECTRONICS">–ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                            <option value="TOOLS_AND_METERS">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–±–æ—Ä—ã</option>
                            <option value="HOME_ELECTRONICS">–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞ (—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞)</option>
                            <option value="DISCOUNT_AND_SALE">–£—Ü–µ–Ω–∫–∞ / –†–∞—Å–ø—Ä–æ–¥–∞–∂–∞</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="grid-two">
                <article class="card">
                    <div class="section-title-row">
                        <div class="card-title" id="productsListTitle">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</div>
                        <button class="btn btn-ghost" id="btnRefreshProducts">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                    <div class="table-wrapper" style="max-height: 360px;">
                        <table>
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th id="productsSkuTh">SKU</th>
                                <th id="productsNameTh">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th id="productsTypeTh">–¢–∏–ø</th>
                                <th id="productsPriceTh">–¶–µ–Ω–∞</th>
                                <th id="productsStockTh">–û—Å—Ç–∞—Ç–æ–∫</th>
                                <th id="productsCategoryTh">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            </tr>
                            </thead>
                            <tbody id="productsBody">
                            <tr><td colspan="7" class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                            </tbody>
                        </table>
                    </div>
                </article>
                <article class="card">
                    <div class="section-title-row">
                        <div class="card-title" id="productsAddTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
                    </div>
                    <div class="content">
                        <div class="form-grid">
                            <div>
                                <label for="prodSku" id="prodSkuLabel">–ê—Ä—Ç–∏–∫—É–ª</label>
                                <input id="prodSku" type="text" placeholder="SKU-IPH-15">
                            </div>
                            <div>
                                <label for="prodName" id="prodNameLabel">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                                <input id="prodName" type="text" placeholder="iPhone 15">
                            </div>
                            <div>
                                <label for="prodPrice" id="prodPriceLabel">–¶–µ–Ω–∞</label>
                                <input id="prodPrice" type="number" step="0.01" placeholder="499999.00">
                            </div>
                            <div>
                                <label for="prodStock" id="prodStockLabel">–û—Å—Ç–∞—Ç–æ–∫ (stock)</label>
                                <input id="prodStock" type="number" placeholder="10">
                            </div>
                            <div>
                                <label for="prodType" id="prodTypeLabel">–í–∏–¥ —Ç–æ–≤–∞—Ä–∞</label>
                                <select id="prodType">
                                    <!-- –ë–∞–∑–æ–≤—ã–µ –≤–∏–¥—ã (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö) -->
                                    <option value="SMARTPHONE">–°–º–∞—Ä—Ç—Ñ–æ–Ω</option>
                                    <option value="LAPTOP">–ù–æ—É—Ç–±—É–∫</option>
                                    <option value="TABLET">–ü–ª–∞–Ω—à–µ—Ç</option>
                                    <option value="MONITOR">–ú–æ–Ω–∏—Ç–æ—Ä</option>
                                    <option value="ACCESSORY">–ê–∫—Å–µ—Å—Å—É–∞—Ä</option>
                                    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–æ–≤ -->
                                    <option value="SMARTPHONES_AND_GADGETS">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ –≥–∞–¥–∂–µ—Ç—ã</option>
                                    <option value="COMPUTERS_AND_LAPTOPS">–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –Ω–æ—É—Ç–±—É–∫–∏</option>
                                    <option value="PC_COMPONENTS">–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ –¥–ª—è –ü–ö</option>
                                    <option value="PC_PERIPHERALS_AND_ACCESSORIES">–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –¥–ª—è –ü–ö</option>
                                    <option value="TV_AND_VIDEO">–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã –∏ –≤–∏–¥–µ–æ</option>
                                    <option value="AUDIO">–ê—É–¥–∏–æ</option>
                                    <option value="PHOTO_AND_VIDEO">–§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ—Ç–µ—Ö–Ω–∏–∫–∞</option>
                                    <option value="GAMES_AND_CONSOLES">–ò–≥—Ä—ã –∏ –∫–æ–Ω—Å–æ–ª–∏</option>
                                    <option value="SMART_HOME">–£–º–Ω—ã–π –¥–æ–º</option>
                                    <option value="NETWORK_EQUIPMENT">–°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
                                    <option value="OFFICE_EQUIPMENT">–û—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞ –∏ –æ—Ñ–∏—Å</option>
                                    <option value="STORAGE_AND_MEMORY">–ù–æ—Å–∏—Ç–µ–ª–∏ –∏ –ø–∞–º—è—Ç—å</option>
                                    <option value="CABLES_AND_ADAPTERS">–ö–∞–±–µ–ª–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫–∏</option>
                                    <option value="CHARGERS_AND_POWER">–ó–∞—Ä—è–¥–∫–∏ –∏ –ø–∏—Ç–∞–Ω–∏–µ</option>
                                    <option value="SMALL_APPLIANCES">–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ (–º–∞–ª–∞—è)</option>
                                    <option value="CLIMATE_APPLIANCES">–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</option>
                                    <option value="CAR_ELECTRONICS">–ê–≤—Ç–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                                    <option value="TOOLS_AND_METERS">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–±–æ—Ä—ã</option>
                                    <option value="HOME_ELECTRONICS">–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞ (—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞)</option>
                                    <option value="DISCOUNT_AND_SALE">–£—Ü–µ–Ω–∫–∞ / –†–∞—Å–ø—Ä–æ–¥–∞–∂–∞</option>
                                </select>
                            </div>
                            <div>
                                <label for="prodCategoryId" id="prodCategoryLabel">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <select id="prodCategoryId">
                                    <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" id="btnAddProduct">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    </div>
                </article>
            </section>
        </div>
    </main>
</div>

<script src="/js/api.js"></script>
<script>
    const productsTexts = {
        ru: {
            title: '–¢–æ–≤–∞—Ä—ã',
            subtitle: '–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ü–∏–∏',
            filterTitle: '–§–∏–ª—å—Ç—Ä',
            listTitle: '–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤',
            addTitle: '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä',
            searchLabel: '–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É',
            typeLabel: '–í–∏–¥ —Ç–æ–≤–∞—Ä–∞',
            skuLabel: '–ê—Ä—Ç–∏–∫—É–ª',
            nameLabel: '–ù–∞–∑–≤–∞–Ω–∏–µ',
            priceLabel: '–¶–µ–Ω–∞',
            stockLabel: '–û—Å—Ç–∞—Ç–æ–∫ (stock)',
            typeEnumLabel: '–í–∏–¥ —Ç–æ–≤–∞—Ä–∞',
            categoryLabel: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
            placeholderSearch: '–ù–∞–ø—Ä–∏–º–µ—Ä, iPhone –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª SKU-IPH-15',
            placeholderSku: 'SKU-IPH-15',
            placeholderName: 'iPhone 15',
            placeholderPrice: '499999.00',
            placeholderStock: '10',
            addButton: '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä',
            none: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö',
            notFound: '–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É',
            loadError: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ',
            createError: '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: ',
            required: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ SKU, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'
        },
        en: {
            title: 'Products',
            subtitle: 'Product catalog',
            filterTitle: 'Filter',
            listTitle: 'Products',
            addTitle: 'Add product',
            searchLabel: 'Search by name or SKU',
            typeLabel: 'Product type',
            skuLabel: 'SKU',
            nameLabel: 'Name',
            priceLabel: 'Price',
            stockLabel: 'Stock',
            typeEnumLabel: 'Type (enum ProductType)',
            categoryLabel: 'Category',
            placeholderSearch: 'e.g. iPhone or SKU-IPH-15',
            placeholderSku: 'SKU-IPH-15',
            placeholderName: 'iPhone 15',
            placeholderPrice: '499999.00',
            placeholderStock: '10',
            addButton: 'Add product',
            none: 'No data',
            notFound: 'No products match the filter',
            loadError: 'Failed to load data: ',
            createError: 'Failed to create product: ',
            required: 'Fill SKU, name, type and category'
        }
    };

    function applyProductsLang(lang) {
        const t = productsTexts[lang];
        document.getElementById('productsTitle').textContent = t.title;
        document.getElementById('productsSubtitle').textContent = t.subtitle;
        document.getElementById('productsFilterTitle').textContent = t.filterTitle;
        document.getElementById('productsListTitle').textContent = t.listTitle;
        document.getElementById('productsAddTitle').textContent = t.addTitle;
        document.getElementById('filterQueryLabel').textContent = t.searchLabel;
        document.getElementById('filterTypeLabel').textContent = t.typeLabel;
        document.getElementById('prodSkuLabel').textContent = t.skuLabel;
        document.getElementById('prodNameLabel').textContent = t.nameLabel;
        document.getElementById('prodPriceLabel').textContent = t.priceLabel;
        document.getElementById('prodStockLabel').textContent = t.stockLabel;
        document.getElementById('prodTypeLabel').textContent = t.typeEnumLabel;
        document.getElementById('prodCategoryLabel').textContent = t.categoryLabel;
        document.getElementById('filterQuery').placeholder = t.placeholderSearch;
        document.getElementById('prodSku').placeholder = t.placeholderSku;
        document.getElementById('prodName').placeholder = t.placeholderName;
        document.getElementById('prodPrice').placeholder = t.placeholderPrice;
        document.getElementById('prodStock').placeholder = t.placeholderStock;
        document.getElementById('btnAddProduct').textContent = t.addButton;
        document.getElementById('btnRefreshProducts').textContent = CURRENT_LANG === 'ru' ? '–û–±–Ω–æ–≤–∏—Ç—å' : 'Refresh';
        document.getElementById('productsSkuTh').textContent = t.skuLabel;
        document.getElementById('productsNameTh').textContent = t.nameLabel;
        document.getElementById('productsTypeTh').textContent = t.typeLabel;
        document.getElementById('productsPriceTh').textContent = t.priceLabel;
        document.getElementById('productsStockTh').textContent = t.stockLabel;
        document.getElementById('productsCategoryTh').textContent = t.categoryLabel;
    }
    let allProducts = [];
    let categoriesIndex = {};

    async function loadInitial() {
        try {
            const [products, categories] = await Promise.all([
                apiGet('/api/products'),
                apiGet('/api/categories')
            ]);
            allProducts = products;
            categoriesIndex = {};
            const select = document.getElementById('prodCategoryId');
            select.innerHTML = '';
            for (const c of categories) {
                categoriesIndex[c.id] = c;
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = `${c.name} (#${c.id})`;
                select.appendChild(opt);
            }
            renderProducts();
        } catch (e) {
            showToast(productsTexts[CURRENT_LANG].loadError + e.message, 'error');
        }
    }

    function renderProducts() {
        const body = document.getElementById('productsBody');
        body.innerHTML = '';
        const q = document.getElementById('filterQuery').value.trim().toLowerCase();
        const t = document.getElementById('filterType').value;
        const filtered = allProducts.filter(p => {
            const matchesText = !q ||
                p.name.toLowerCase().includes(q) ||
                p.sku.toLowerCase().includes(q);
            const matchesType = !t || p.type === t;
            return matchesText && matchesType;
        });
        if (filtered.length === 0) {
            body.innerHTML = `<tr><td colspan="7" class="muted">${productsTexts[CURRENT_LANG].notFound}</td></tr>`;
            return;
        }
        for (const p of filtered) {
            const tr = document.createElement('tr');
            const category = p.categoryName || (p.category && p.category.name);
            if (p.stock !== undefined && p.stock <= 2) {
                tr.classList.add('row-low-stock');
            }
            tr.innerHTML = `
                <td>${p.id}</td>
                <td>${p.sku}</td>
                <td>${p.name}</td>
                <td><span class="badge">${p.type}</span></td>
                <td>${formatMoney(p.price)}</td>
                <td>${p.stock}</td>
                <td>${category ?? ('#' + p.categoryId)}</td>
            `;
            body.appendChild(tr);
        }
    }

    async function addProduct() {
        const sku = document.getElementById('prodSku').value.trim();
        const name = document.getElementById('prodName').value.trim();
        const price = Number(document.getElementById('prodPrice').value);
        const stock = Number(document.getElementById('prodStock').value);
        const type = document.getElementById('prodType').value;
        const categoryId = Number(document.getElementById('prodCategoryId').value);

        if (!sku || !name || !type || !categoryId) {
            showToast(productsTexts[CURRENT_LANG].required, 'error');
            return;
        }

        try {
            await apiPost('/api/products', { sku, name, price, stock, type, categoryId });
            document.getElementById('prodSku').value = '';
            document.getElementById('prodName').value = '';
            document.getElementById('prodPrice').value = '';
            document.getElementById('prodStock').value = '';
            showToast('OK', 'success');
            await loadInitial();
        } catch (e) {
            showToast(productsTexts[CURRENT_LANG].createError + e.message, 'error');
        }
    }

    document.getElementById('btnRefreshProducts').addEventListener('click', loadInitial);
    document.getElementById('btnAddProduct').addEventListener('click', addProduct);
    document.getElementById('filterQuery').addEventListener('input', renderProducts);
    document.getElementById('filterType').addEventListener('change', renderProducts);

    initLanguageToggle(applyProductsLang);
    loadInitial();
</script>
</body>
</html>


